apiVersion: flink.apache.org/v1beta1
kind: FlinkDeployment
metadata:
  name: enriched-orders-cluster
spec:
  image: idstudios/flink-enriched-orders:1.20
  flinkVersion: v1_19
  flinkConfiguration:
    taskmanager.numberOfTaskSlots: "5"
  serviceAccount: flink
  podTemplate:
    spec:
      containers:
        # Do not change the main container name
        - name: flink-main-container
          # values in enriched-orders-job.properties can be overridden
          # as ENV variables, which will take precedence
          # K8s SECRETS can be used for sensitive data such as passwords
          env:
            - name: MYSQL_ERPDB_DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: enriched-orders-mysql-erpdb-password
                  key: secret
            - name: MYSQL_OPSDB_DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: enriched-orders-mysql-opsdb-password
                  key: secret
            - name: POSTGRES_SHIPDB_DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: enriched-orders-postgres-shipdb-password
                  key: secret
  jobManager:
    resource:
      memory: "2048m"
      cpu: 1
  taskManager:
    resource:
      memory: "2048m"
      cpu: 1
  job:
    jarURI: local:///flink-jobjars/enriched-orders-job-1.0.0.jar
    parallelism: 2
    upgradeMode: stateless